---
- name: drush | deps
  apt: pkg=$item state=installed
  with_items:
    - php-pear
    - make
    - php5-dev
    - libpcre3-dev

- name: php | update pear
  command: pear upgrade

- name: php | pear auto-discover
  command: pear config-set auto_discover 1

- name: php | PEAR check for drush
  command: pear list -a | grep -i drush || true
  register: php_pear_drush_exists

- name: drush | PEAR channel...
  command: pear channel-discover pear.drush.org
  when_string: ${php_pear_drush_exists.stdout} == ''

- name: drush | install drush
  command: pear install drush/drush
  when_string: ${php_pear_drush_exists.stdout} == ''

- name: drush | init drush
  command: drush
  when_string: ${php_pear_drush_exists.stdout} == ''
